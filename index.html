<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dify Workflow Tester</title>
    <!-- Add CDN link for marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Base styles (Keep existing styles from previous version) */
        :root {
            --bg-color: #0d1117; /* GitHub dark background */
            --container-bg: #161b22; /* Slightly lighter container */
            --border-color: #30363d; /* GitHub border */
            --input-bg: #0d1117; /* Input background */
            --input-border: #21262d; /* Input border */
            --text-primary: #c9d1d9; /* Primary text */
            --text-secondary: #8b949e; /* Secondary/label text */
            --accent-blue: #58a6ff; /* GitHub blue */
            --button-bg: #238636; /* GitHub green button */
            --button-hover-bg: #2ea043; /* GitHub green button hover */
            --button-secondary-bg: #21262d; /* Secondary button bg */
            --button-secondary-hover-bg: #30363d; /* Secondary button hover */
            --button-secondary-border: #30363d;
            --error-text: #f85149; /* GitHub error red */
            --error-border: #f85149;
            --shadow-subtle: rgba(0, 0, 0, 0.2);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            margin: 0;
            padding: 15px;
            display: flex;
            justify-content: center;
            line-height: 1.5;
        }

        .container {
            background-color: var(--container-bg);
            padding: 25px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            box-shadow: 0 5px 15px var(--shadow-subtle);
            width: 100%;
            max-width: 580px;
        }

        h1, h2 {
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        h1 { font-size: 1.6em; }
        h2 { font-size: 1.3em; }

        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 6px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.85em;
        }

        .label-container { /* Flex container for label and button */
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .label-container label {
            margin-top: 0; /* Remove top margin from label inside flex */
        }


        input[type="number"],
        select,
        textarea {
            width: calc(100% - 20px);
            padding: 8px 10px;
            margin-bottom: 12px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            background-color: var(--input-bg);
            color: var(--text-primary);
            font-size: 0.95rem;
            line-height: 1.4;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            border-color: var(--accent-blue);
            outline: none;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        select {
             width: 100%;
             appearance: none;
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%238b949e'%3E%3Cpath d='M4.427 7.427l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 7H4.604a.25.25 0 00-.177.427z'/%3E%3C/svg%3E");
             background-repeat: no-repeat;
             background-position: right 10px center;
             background-size: 16px;
             padding-right: 30px;
        }

        button { /* Main Generate Button */
            background-color: var(--button-bg);
            color: white;
            padding: 9px 18px;
            border: 1px solid rgba(240, 246, 252, 0.1);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: background-color 0.2s ease-out;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background-color: var(--button-hover-bg);
            border-color: rgba(240, 246, 252, 0.1);
        }
        button:disabled {
             background-color: #21262d;
             color: #8b949e;
             cursor: not-allowed;
             border-color: rgba(240, 246, 252, 0.1);
        }

        .secondary-button { /* Style for Load Sample button */
             background-color: var(--button-secondary-bg);
             color: var(--text-secondary);
             padding: 4px 10px; /* Smaller padding */
             border: 1px solid var(--button-secondary-border);
             border-radius: 6px;
             cursor: pointer;
             font-size: 0.8em; /* Smaller font */
             font-weight: 500;
             transition: background-color 0.2s ease-out, border-color 0.2s ease-out;
        }
        .secondary-button:hover {
             background-color: var(--button-secondary-hover-bg);
             border-color: #8b949e; /* Slightly lighter border on hover */
             color: var(--text-primary);
        }


        hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 30px 0;
        }

        .output-box, .error-box {
            background-color: var(--input-bg);
            padding: 12px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            margin-top: 8px;
            min-height: 80px;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.9em;
            line-height: 1.5;
        }
        .output-box strong { color: #adc1d1; font-weight: 600; }
        .output-box h1, .output-box h2, .output-box h3 { color: var(--text-primary); border-bottom: 1px solid var(--border-color); padding-bottom: 4px; margin-top: 1.2em; margin-bottom: 0.8em; font-weight: 600; font-size: 1.1em; }
        .output-box ul { margin-left: 0; padding-left: 1.8em; list-style: disc; margin-top: 0.4em; margin-bottom: 0.8em; }
        .output-box li { margin-bottom: 0.4em; }
        .error-box { color: var(--error-text); border-color: var(--error-border); background-color: rgba(248, 81, 73, 0.05); }

        #loading {
            color: var(--text-secondary);
            margin-top: 10px;
            text-align: center;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ¨ AI Content Generator</h1>

        <label for="taskType">Select Task:</label>
        <select id="taskType">
            <option value="bio_description">Generate Job Seeker Bio</option>
            <option value="job_description">Generate Job Description</option>
            <option value="project_description">Generate Project Description</option>
            <option value="experience_description">Generate Work Experience</option>
            <option value="education_description">Generate Education Description</option>
            <option value="test_description">Test Description</option>
        </select>

        <!-- *** UPDATED: Label and Load Sample Button in a container *** -->
        <div class="label-container">
            <label for="inputText">Input Details:</label>
            <button id="loadSampleButton" class="secondary-button">Load Sample</button>
        </div>
        <textarea id="inputText" rows="8" placeholder="Enter details for the selected task or click 'Load Sample'..."></textarea>

        <label for="maxLength" id="maxLengthLabel">Max Output Length (Job Desc Only):</label>
        <input type="number" id="maxLength" placeholder="e.g., 1500">

        <button id="generateButton">Generate</button>

        <hr>

        <h2>Generated Output:</h2>
        <div id="output" class="output-box">
            Waiting for generation...
        </div>
        <div id="tokenInfo" style="font-size: 0.8em; color: var(--text-secondary); margin-top: 5px; text-align: right;"></div>
        <div id="loading" style="display: none;">Generating...</div>
        <div id="error" class="error-box" style="display: none;"></div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const taskTypeSelect = document.getElementById('taskType');
            const inputTextarea = document.getElementById('inputText');
            const maxLengthInput = document.getElementById('maxLength');
            const maxLengthLabel = document.getElementById('maxLengthLabel');
            const generateButton = document.getElementById('generateButton');
            const loadSampleButton = document.getElementById('loadSampleButton');
            const outputDiv = document.getElementById('output');
            const tokenInfoDiv = document.getElementById('tokenInfo');
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error');

            const DIFY_API_URL = 'https://api.dify.ai/v1/workflows/run';
            const DIFY_API_KEY = 'app-cgtngfiCzymjd46gM1oValin';
            const DIFY_USER_ID = 'test-user-html-123';

             // *** NEW: Sample Text Data ***
             const sampleTexts = {
                bio_description: `I'm aiming for a Senior Product Manager role. I have about 8 years of experience, mostly in SaaS B2B products. My strengths include roadmap planning, user research, A/B testing, and leading cross-functional teams. I successfully launched 3 major features last year that increased user retention by 10%.`,
                job_description: `Hiring a junior graphic designer. Needs proficiency in Adobe Creative Suite (Photoshop, Illustrator mainly). Responsibilities include creating social media graphics, assisting with presentation design, and maintaining brand consistency across materials. Looking for someone creative with a good portfolio, maybe 1 year experience or strong intern work. Bachelor's degree preferred.`,
                project_description: `Project: E-commerce Checkout Redesign. Goal was to improve conversion rate. I was the lead frontend developer. Used React, Redux, and Stripe API. Conducted user testing and iterated on the design based on feedback. Resulted in a 15% increase in completed checkouts after launch in Q3.`,
                experience_description: `Role: Marketing Specialist at Tech Solutions Inc. (June 2021 - Present). I manage PPC campaigns on Google Ads and LinkedIn, optimize landing pages for conversion, create weekly performance reports, and collaborate with the sales team on lead generation. Increased lead quality score by 20% through better campaign targeting. Managed a budget of $50k/quarter.`,
                education_description: `University of Example, B.S. in Computer Science, graduated May 2023. GPA: 3.8. Relevant courses: Data Structures, Algorithms, AI, Database Management. Senior Project: Developed a mobile app for campus event discovery using React Native and Firebase. Dean's List for 4 semesters.`,
                test_description: `This is a test input to see how the model handles generic text. Please summarize this sentence in a professional tone. The goal is to verify the workflow connects properly and the selected AI model responds.`
            };

            // --- Event Listener for Load Sample Button ---
            loadSampleButton.addEventListener('click', () => {
                const selectedTask = taskTypeSelect.value;
                if (sampleTexts[selectedTask]) {
                    inputTextarea.value = sampleTexts[selectedTask];
                } else {
                    inputTextarea.value = ''; // Clear if no sample exists for some reason
                }
            });
            // --- End Load Sample Logic ---


            function toggleMaxLengthVisibility() {
                if (taskTypeSelect.value === 'job_description') {
                    maxLengthInput.style.display = 'block';
                    maxLengthLabel.style.display = 'block';
                } else {
                    maxLengthInput.style.display = 'none';
                    maxLengthLabel.style.display = 'none';
                    maxLengthInput.value = '';
                }
            }
            toggleMaxLengthVisibility();
            taskTypeSelect.addEventListener('change', toggleMaxLengthVisibility);

            generateButton.addEventListener('click', async () => {
                const taskType = taskTypeSelect.value;
                const inputText = inputTextarea.value.trim();
                const maxLength = maxLengthInput.value ? parseInt(maxLengthInput.value, 10) : null;

                outputDiv.innerHTML = 'Waiting for generation...';
                tokenInfoDiv.textContent = '';
                outputDiv.style.display = 'block';
                loadingDiv.style.display = 'block';
                errorDiv.style.display = 'none';
                errorDiv.textContent = '';
                generateButton.disabled = true;

                let inputs = {
                    task_type: taskType,
                    input_text: inputText
                };
                if (taskType === 'job_description' && maxLength) {
                    inputs.max_output_length = maxLength;
                }

                if (!inputText) {
                    showError('Input text cannot be empty.');
                    resetUIState();
                    return;
                }

                try {
                    const response = await fetch(DIFY_API_URL, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${DIFY_API_KEY}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            inputs: inputs,
                            response_mode: 'blocking',
                            user: DIFY_USER_ID,
                        }),
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API Error (${response.status}): ${errorData.code} - ${errorData.message || 'Unknown error'}`);
                    }

                    const result = await response.json();

                    if (result?.data?.status !== 'succeeded') {
                         throw new Error(`Workflow failed: ${result?.data?.error || 'Unknown Dify workflow error'}`);
                    }

                    const rawGeneratedText = result?.data?.outputs?.output || 'No output received or unexpected response structure.';
                    const tokenCount = result?.data?.total_tokens;

                    const sanitizedHtml = marked.parse(rawGeneratedText, { sanitize: false });
                    outputDiv.innerHTML = sanitizedHtml;

                    if (tokenCount !== undefined && tokenCount !== null) {
                         tokenInfoDiv.textContent = `Tokens used: ${tokenCount}`;
                    } else {
                         tokenInfoDiv.textContent = '';
                    }

                } catch (error) {
                    console.error('Error calling Dify API:', error);
                    showError(`Failed to generate content: ${error.message}`);
                } finally {
                    resetUIState();
                }
            });

            function showError(message) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                outputDiv.style.display = 'none';
                tokenInfoDiv.textContent = '';
            }

            function resetUIState() {
                loadingDiv.style.display = 'none';
                generateButton.disabled = false;
            }
        });
    </script>
</body>
</html>